<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <title>Advanced Chatfuel Customer Chat Plugin</title>
      <link rel="icon" type="image/png" href="./favicon.png" />
      <meta name="description" content="">
      <meta name="author" content="">
      <meta property="og:title" content="Advanced Chatfuel Customer Chat Plugin">
        <meta property="og:site_name" content="Advanced Chatfuel Customer Chat Plugin">
        <meta property="og:url" content="https://github.com/Ademking/Advanced-Chatfuel-Customer-Chat-Plugin">
        <meta property="og:description" content="By @Ademkouki">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://cdn4.iconfinder.com/data/icons/flipicons-vol-2-2/512/Facebook_Messenger-512.png">
      <style type="text/css">
         .centered {
         position: absolute;
         top: 73%;
         left: 50%;
         transform: translate(-50%, -50%);
         }
         .top {
         position: absolute;
         margin-left: auto;
         margin-right: auto;
         left: 0;
         right: 0;
         width: 80%;
         height: 75px;
         /*background-color:rgba(0, 255, 8, 0.47);*/
         top: 19px;
         }
         #welcometext{
         padding-left: 3rem !important;
         padding-top: 1.1rem !important;
         }
         .inside-top{
         margin-right: 18%;
         }
         @media (min-width: 767px) {
         .top {
         height:75px;
         width: 432px;
         }
         .inside-top{
         margin-right: 80px;
         }
         }
         @media (max-width: 446px) { 
         #welcometext{
         font-size:12px !important;
         }
         }
      </style>
      <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.5.3/css/bootstrap-colorpicker.css" />
      <link rel="stylesheet" href="https://www.jqueryscript.net/demo/Color-Picker-Plugin-jQuery-MiniColors/jquery.minicolors.css" type="text/css" />
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.26.11/sweetalert2.min.css" />
   </head>
   <body>
      <div class="container">
         <div class="row grid">
            <div class="col-lg-12 text-center">
               <img src="fbchat.png" class="img-fluid"></img>
               <div class="centered">
                  <h6>Chat Now</h6>
               </div>
               <div class="top">
                  <div class="inside-top">
                     <h6 class="text-left" id="welcometext">Your Message Here...</h6>
                  </div>
               </div>
            </div>
            <div class="col-lg-12 text-center">
               <!-- circle start -->
               <div tabindex="0" role="button" style="cursor: pointer; outline: none;">
                  <svg width="60px" height="60px" viewBox="0 0 60 60">
                     <svg x="0" y="0" width="60" height="60">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                           <g>
                              <g>
                                 <circle id="circle-color" fill="#0084FF" cx="30" cy="30" r="30"></circle>
                                 <g transform="translate(10.000000, 11.000000)" fill="#FFFFFF">
                                    <path d="M0,18.7150914 C0,8.37723141 8.956743,0 20,0 C31.043257,0 40,8.37723141 40,18.7150914 C40,29.0529515 31.043257,37.4301829 20,37.4301829 C18,37.4301829 16.0763359,37.1551856 14.2544529,36.6459314 L6.95652174,40 L6.95652174,33.0434783 C2.44929143,29.6044708 0,24.5969773 0,18.7150914 Z M16.9276495,19.6993886 L22.109375,25.0798234 L33.0434783,13.4782609 L23.0672554,18.9962636 L17.890625,13.6158288 L6.95652174,25.2173913 L16.9276495,19.6993886 Z"></path>
                                 </g>
                              </g>
                           </g>
                        </g>
                     </svg>
                  </svg>
               </div>
               <!-- circle end -->
            </div>
         </div>
      </div>
      <div class="container">
         <div class="row grid pt-4">
            <div class="col-lg-12 pb-4">
               <h3 class="text-center" style="color: #0084FF">Advanced Chatfuel Customer Chat Plugin</h3>
               <h6 class="text-center">By <a href="https://facebook.com/AdemkoukiOfficiel">@AdemKouki</a></h6>
            </div>
            <div class="col-lg-6 pt-3">
               <h6>1. Paste Your Code :</h6>
               <textarea class="form-control" rows="3" id="comment" placeholder="Paste your code here... (From Chatfuel)"></textarea>
            </div>
            <div class="col-lg-6 pt-3">
               <div class="form-group">
                  <h6>2. Write your "Logged-In" & "Logged-Out" Messages :</h6>
                  <input type="text" class="form-control"  placeholder="Logged In Greeting" id="txt-logged" maxlength="77">
               </div>
               <div class="form-group">
                  <input type="text" class="form-control"  placeholder="Logged Out Greeting" id="txt-logged-out" maxlength="77">
               </div>
            </div>
            <div class="col-lg-4 pb-3">
               <div class="form-group pb-3">
                        
                       <h6>3. Select your Color :</h6>
                      <input type="text" id="hue-demo" class="form-control demo" data-control="hue" value="#0084FF">

               </div>
            </div>
         
            <div class="col-lg-8 pb-5">
                   <h6>4. Click "Generate" :</h6>
                  <button id="btngenerete" class="btn btn-primary btn-block">Generate</button>
              
            </div>
            
            
         </div>
      </div>
      
      
      <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Thank you ♥ ! This is your code :</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
           
   
            <textarea class="form-control" rows="4" id="final-code" placeholder="Your code..."></textarea>
            <br>
            <div class="row">
             
                 <div class="col-12">
                    
                   
                    <button type="button" class="btn btn-primary btn-block" onclick="copy()">Copy Code</button>
                </div>
            </div>
          </div>
          <div class="modal-foote mx-auto">
            <h6 class="py-3">If you like this tool, please donate something.♥ PayPal: ademkingnew@gmail.com</h6>
          </div>
        </div>
      </div>
    </div>
     <!-- Modal --> 
      
      
      
      </div>
      <script src="//code.jquery.com/jquery-3.3.1.js"></script>
      <script src="//cdn.rawgit.com/twbs/bootstrap/v4.1.3/dist/js/bootstrap.bundle.min.js"></script>
      <script type="text/javascript" src="https://www.jqueryscript.net/demo/Color-Picker-Plugin-jQuery-MiniColors/jquery.minicolors.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.26.11/sweetalert2.all.min.js"></script>
      <script>
      
      function copy(){
          let textarea = document.getElementById("final-code");
          textarea.select();
          document.execCommand("copy");
      }
      
    $(document).ready( function() {
        
        // default color:
         $(".centered h6").css('color', '#0084FF');
        
        
        
        $("#hue-demo").change(function () {
            $(".centered h6").css('color', $("#hue-demo").val());
            $("#circle-color").attr("fill",$("#hue-demo").val());
        });
        
        
         $('#txt-logged').on('keyup paste',username_check);
        
        
        function username_check(){
             $("#welcometext").text($("#txt-logged").val()); 
        }

        
       

      $('.demo').each( function() {
        //
        // Dear reader, it's actually very easy to initialize MiniColors. For example:
        //
        //  $(selector).minicolors();
        //
        // The way I've done it below is just for the demo, so don't get confused
        // by it. Also, data- attributes aren't supported at this time...they're
        // only used for this demo.
        //
        $(this).minicolors({
          control: $(this).attr('data-control') || 'hue',
          defaultValue: $(this).attr('data-defaultValue') || '',
          format: $(this).attr('data-format') || 'hex',
          keywords: $(this).attr('data-keywords') || '',
          inline: $(this).attr('data-inline') === 'true',
          letterCase: $(this).attr('data-letterCase') || 'lowercase',
          opacity: $(this).attr('data-opacity'),
          position: $(this).attr('data-position') || 'top left',
          swatches: $(this).attr('data-swatches') ? $(this).attr('data-swatches').split('|') : [],
          change: function(value, opacity) {
            if( !value ) return;
            if( opacity ) value += ', ' + opacity;
            if( typeof console === 'object' ) {
              console.log(value);
            }
          },
          theme: 'bootstrap'
        });

      });
      
     
      

    });
    
    
    
      ///////////////////////////
      //// custom code parsing //
      ///////////////////////////
      
      function parseHTML(markup) {
    if (markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
        var doc = document.implementation.createHTMLDocument("");
        doc.documentElement.innerHTML = markup;
        return doc;
    } else if ('content' in document.createElement('template')) {
       // Template tag exists!
       var el = document.createElement('template');
       el.innerHTML = markup;
       return el.content;
    } else {
       // Template tag doesn't exist!
       var docfrag = document.createDocumentFragment();
       var el = document.createElement('body');
       el.innerHTML = markup;
       for (i = 0; 0 < el.childNodes.length;) {
           docfrag.appendChild(el.childNodes[i]);
       }
       return docfrag;
    }
}
      
      
      
      
       let code ;
       let page_id;

	
      $("#btngenerete").click(() => {
         code = $("textarea").val();
         
         
         
         try{
             
             let div = parseHTML('<html>'+code+'</html>').querySelector('div');
             page_id = div.getAttribute('page_id');

             
             let regex = /(?<=: ')(.*)(?=',  )/gm;
             let app_id = code.match(regex);
             console.log(app_id);
             let logged_in_greeting = $("#txt-logged").val();
             let logged_out_greeting = $("#txt-logged-out").val();
             let color = $("#hue-demo").val();

             
             
                      let myvar = '<script type="text/javascript">'+
                    '      window.fbMessengerPlugins = window.fbMessengerPlugins || {'+
                    '        init: function () {'+
                    '          FB.init({'+
                    '            appId: \''+app_id+'\','+
                    '            autoLogAppEvents : true,'+
                    '            xfbml: true,'+
                    '            version: \'v3.0\''+
                    '          });'+
                    '        }, callable: []'+
                    '      };'+
                    '      window.fbAsyncInit = window.fbAsyncInit || function () {'+
                    '        window.fbMessengerPlugins.callable.forEach(function (item) { item(); });'+
                    '        window.fbMessengerPlugins.init();'+
                    '      };'+
                    '      setTimeout(function () {'+
                    '        (function (d, s, id) {'+
                    '          var js, fjs = d.getElementsByTagName(s)[0];'+
                    '          if (d.getElementById(id)) { return; }'+
                    '          js = d.createElement(s);'+
                    '          js.id = id;'+
                    '          js.src = "//connect.facebook.net/en_US/sdk.js";'+
                    '          fjs.parentNode.insertBefore(js, fjs);'+
                    '        }(document, \'script\', \'facebook-jssdk\'));'+
                    '      }, 0);'+
                    '<\/script>'+
                    ''+
                    '    '+
                    '    <div'+
                    '        class="fb-customerchat"  attribution=setup_tool'+
                    '        page_id="'+page_id+'" theme_color="'+color+'" logged_in_greeting="'+logged_in_greeting+'"'+
                    '        logged_out_greeting="'+logged_out_greeting+'"'+
                    '        ref="">'+
                    '      </div>';
             
             
             
             $("#final-code").val(myvar);
             $("#exampleModal").modal();
             
          
             
         }
         
         
         
         
         catch (e) {
            swal({
              type: 'error',
              title: 'Oops...',
              text: 'Something went wrong! Check your Code...',
              footer: '<a href="https://facebook.com/AdemkoukiOfficiel">Contact Developer</a>'
            });
         }
         
         
      });
      
      
      
      
    
  </script>
   </body>
</html>
